import{c as C,r as h,R as F,j as e}from"./index-CCpUXIc_.js";import{P as v}from"./papaparse.min-vXx6ucLC.js";import{A as y}from"./api-DZ1q1-OU.js";import{U as z}from"./users-Dy1W4xyk.js";import{F as S,C as D}from"./file-text-B7ftF6p9.js";import{C as B}from"./circle-alert-BMfqJDfU.js";const E=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],T=C("settings",E);const U=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],P=C("upload",U),M={parseCSV:l=>new Promise((o,n)=>{v.parse(l,{header:!0,skipEmptyLines:!0,complete:a=>{o(a.data)},error:a=>{n(a)}})}),exportCSV:(l,o)=>{const n=v.unparse(l),a=new Blob(["\uFEFF"+n],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(i.download!==void 0){const x=URL.createObjectURL(a);i.setAttribute("href",x),i.setAttribute("download",o),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}},autoMapEvaluators:l=>{const o={};return l.forEach(n=>{o[n.id]={peers:[],manager:[],staff:[]},l.forEach(a=>{n.id!==a.id&&n.department===a.department&&n.position===a.position&&o[n.id].peers.push(a.id)})}),o}};function $(){const[l,o]=h.useState({total:0,completed:0,progress:0}),[n,a]=h.useState(!1),[i,x]=h.useState([]),[u,N]=h.useState("employee"),[j,k]=h.useState(null);F.useEffect(()=>{(async()=>{const s=await y.fetchEmployees();if(s&&Array.isArray(s)){const r=s.length;o({total:r,completed:0,progress:0})}})()},[]);const b=async(t,s)=>{const r=t.target.files[0];if(N(s),r)try{const d=await M.parseCSV(r);x(d),a(!0),t.target.value=""}catch{alert("CSV íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},w=async()=>{if(alert("ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”."),u==="employee"){const t=await y.syncEmployees(i);t.success?(o(s=>({...s,total:i.length})),a(!1),alert(`${i.length}ëª…ì˜ ì§ì› ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.`)):alert("ë™ê¸°í™” ì‹¤íŒ¨: "+t.error)}else{const t=R(i);k(t);const s=t.map(c=>{const m=parseFloat(c.totalScore)||0;let p="D";return m>=95?p="S":m>=85?p="A":m>=75?p="B":m>=65&&(p="C"),{name:c.Name||c.name||c.ì´ë¦„,team:c.Team||c.team||c.ë¶€ì„œ,totalScore:c.totalScore,grade:p}});localStorage.setItem("evaluationResults",JSON.stringify(s));const r={total:l.total,completed:t.length,completedRatio:Math.round(t.length/(l.total||1)*100)};o(r),localStorage.setItem("dashboardStats",JSON.stringify({totalUsers:r.total,completedCount:r.completed,completedRatio:r.completedRatio}));const d=await y.syncResults(t);d.success?(a(!1),alert("í‰ê°€ ê²°ê³¼ ë° ë¶„ì„ ë‚´ìš©ì´ ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.")):alert("ê²°ê³¼ ë™ê¸°í™” ì‹¤íŒ¨: "+d.error)}},R=t=>{const s={self:.2,peer:.2,manager:.4,sub:.2};return t.map(r=>{const d=parseFloat(r.SelfScore)||0,c=parseFloat(r.PeerScore)||0,m=parseFloat(r.ManagerScore)||0,p=parseFloat(r.SubordinateScore)||0,A=d*s.self+c*s.peer+m*s.manager+p*s.sub;return{...r,totalScore:A.toFixed(1)}})},I=(t,s,r)=>{const d=[...i];d[t][s]=r,x(d)};return e.jsxs("div",{className:"dashboard-grid animate-fade-in",children:[e.jsxs("div",{className:"card",style:{gridColumn:"1 / -1",marginBottom:"2rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{children:"ê´€ë¦¬ìë‹˜, ì•ˆë…•í•˜ì„¸ìš”."}),e.jsxs("a",{href:"#/admin/config",className:"btn btn-outline",style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem"},children:[e.jsx(T,{size:18})," ì„¤ì •"]})]}),e.jsx("p",{className:"text-sub",children:"2025ë…„ ê·¼ë¬´í‰ì • ì¢…í•© í˜„í™©ì…ë‹ˆë‹¤."}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"1.5rem",marginTop:"1.5rem"},children:[e.jsx(g,{icon:e.jsx(z,{className:"text-blue-500"}),label:"ì „ì²´ ëŒ€ìƒì",value:l.total,sub:"í‰ê°€ ëŒ€ìƒ"}),e.jsx(g,{icon:e.jsx(S,{className:"text-teal-500"}),label:"í‰ê°€ ì œì¶œ",value:l.completed,sub:"ì™„ë£Œ ê±´ìˆ˜"}),e.jsx(g,{icon:e.jsx(D,{className:"text-indigo-500"}),label:"ì§„í–‰ë¥ ",value:`${l.progress}%`,sub:"ì „ì²´ í‰ê· "}),e.jsxs("div",{className:"card",style:{border:"2px dashed var(--border-light)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",padding:"1rem",background:"rgba(255,255,255,0.5)"},children:[e.jsx("input",{type:"file",id:"csvInput",style:{display:"none"},onChange:t=>b(t,"employee"),accept:".csv"}),e.jsxs("label",{htmlFor:"csvInput",style:{cursor:"pointer",textAlign:"center",width:"100%"},children:[e.jsx(P,{className:"text-sub",size:32,style:{marginBottom:"0.5rem"}}),e.jsx("div",{style:{fontWeight:600},children:"ì§ì› ëª…ë‹¨ ì—…ë¡œë“œ"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-sub)"},children:"CSV í˜•ì‹ ì§€ì›"})]})]}),e.jsxs("div",{className:"card",style:{border:"2px dashed var(--primary-200)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",padding:"1rem",background:"var(--primary-50)"},children:[e.jsx("input",{type:"file",id:"resultInput",style:{display:"none"},onChange:t=>b(t,"result"),accept:".csv"}),e.jsxs("label",{htmlFor:"resultInput",style:{cursor:"pointer",textAlign:"center",width:"100%"},children:[e.jsx(S,{className:"text-primary-600",size:32,style:{marginBottom:"0.5rem"}}),e.jsx("div",{style:{fontWeight:600,color:"var(--primary-700)"},children:"í‰ê°€ ê²°ê³¼ ì—…ë¡œë“œ"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--primary-600)"},children:"ì ìˆ˜ ì·¨í•© CSV ë¶„ì„"})]})]})]}),j&&e.jsxs("div",{style:{marginTop:"2rem",padding:"1rem",background:"#f8fafc",borderRadius:"8px"},children:[e.jsx("h3",{children:"ğŸ“Š ë¶„ì„ ê²°ê³¼ ìš”ì•½"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"1rem",background:"white"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"var(--primary-100)"},children:[e.jsx("th",{style:{padding:"0.5rem"},children:"ì„±ëª…"}),e.jsx("th",{style:{padding:"0.5rem"},children:"ì§ìœ„"}),e.jsx("th",{style:{padding:"0.5rem"},children:"ì´ì "}),e.jsx("th",{style:{padding:"0.5rem"},children:"ë“±ê¸‰"})]})}),e.jsx("tbody",{children:j.map((t,s)=>e.jsxs("tr",{style:{borderBottom:"1px solid #eee",textAlign:"center"},children:[e.jsx("td",{style:{padding:"0.5rem"},children:t.Name||t.name}),e.jsx("td",{style:{padding:"0.5rem"},children:t.Role||t.role}),e.jsx("td",{style:{padding:"0.5rem",fontWeight:"bold"},children:t.totalScore}),e.jsx("td",{style:{padding:"0.5rem"},children:t.totalScore>=90?"S":t.totalScore>=80?"A":"B"})]},s))})]})]})]}),e.jsxs("div",{className:"card",style:{minHeight:"400px"},children:[e.jsx("h3",{children:"ë¶€ì„œë³„ í˜„í™©"}),e.jsx("p",{className:"text-sub",children:"ì‹¤ì‹œê°„ ì œì¶œ í˜„í™© ëª¨ë‹ˆí„°ë§"}),e.jsx("div",{style:{background:"var(--bg-input)",height:"200px",borderRadius:"var(--radius-md)",display:"flex",alignItems:"center",justifyContent:"center",marginTop:"1rem"},children:"ì°¨íŠ¸ ì˜ì—­ (ë°ì´í„° ì—°ë™ ì‹œ í™œì„±í™”)"})]}),e.jsxs("div",{className:"card",style:{minHeight:"400px"},children:[e.jsx("h3",{children:"ì£¼ìš” ì•Œë¦¼"}),e.jsxs("div",{style:{display:"flex",gap:"1rem",flexDirection:"column",marginTop:"1.5rem"},children:[e.jsx(f,{type:"weak",msg:"ë¯¸ì œì¶œ ì¸ì› 3ëª… (ë…ì´‰ í•„ìš”)"}),e.jsx(f,{type:"info",msg:"ìš´ì˜ì§€ì›íŒ€: í‰ê°€ ì™„ë£Œìœ¨ 90% ë‹¬ì„±"}),e.jsx(f,{type:"info",msg:"ì‚¬ì—…1íŒ€: í‰ê°€ ì™„ë£Œìœ¨ 85% ë‹¬ì„±"})]})]}),n&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{className:"card",style:{width:"80%",maxHeight:"80%",overflow:"hidden",display:"flex",flexDirection:"column",padding:"1.5rem"},children:[e.jsxs("h3",{children:["ë°ì´í„° ê²€ì¦ ë° ìˆ˜ì • (",u==="employee"?"ì§ì›ëª…ë¶€":"í‰ê°€ê²°ê³¼",")"]}),e.jsx("p",{className:"text-sub",style:{marginBottom:"1rem"},children:"ì—…ë¡œë“œëœ ë°ì´í„°ë¥¼ ê²€í† í•˜ê³  í•„ìš”ì‹œ ì§ì ‘ ìˆ˜ì •í•˜ì„¸ìš”."}),e.jsx("div",{style:{overflow:"auto",flex:1,border:"1px solid var(--border-light)",marginBottom:"1rem"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.9rem"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{position:"sticky",top:0,background:"var(--bg-input)"},children:i.length>0&&Object.keys(i[0]).map(t=>e.jsx("th",{style:{padding:"0.5rem"},children:t},t))})}),e.jsx("tbody",{children:i.slice(0,100).map((t,s)=>e.jsx("tr",{style:{borderBottom:"1px solid var(--border-light)"},children:Object.keys(t).map(r=>e.jsx("td",{style:{padding:"0.3rem"},children:e.jsx("input",{className:"input-field",value:t[r]||"",onChange:d=>I(s,r,d.target.value)})},r))},s))})]})}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>a(!1),children:"ì·¨ì†Œ"}),e.jsx("button",{className:"btn btn-primary",onClick:w,children:u==="employee"?"DB ë™ê¸°í™”":"ë¶„ì„ ì‹¤í–‰"})]})]})})]})}function g({icon:l,label:o,value:n,sub:a}){return e.jsxs("div",{style:{padding:"1.5rem",background:"var(--bg-input)",borderRadius:"var(--radius-md)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[o,l]}),e.jsx("div",{style:{fontSize:"2rem",fontWeight:700},children:n}),e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-sub)"},children:a})]})}function f({type:l,msg:o}){const n=l==="weak"?"#ef4444":"#3b82f6";return e.jsxs("div",{style:{padding:"1rem",borderLeft:`4px solid ${n}`,background:"var(--bg-input)",display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx(B,{size:20,color:n}),e.jsx("span",{children:o})]})}export{$ as default};
