import{c as R,r as x,R as z,j as e}from"./index-DI61_OFc.js";import{U as D,D as A}from"./dataEngine-Y_tNgGIs.js";import{A as g}from"./api-DQv-KOUb.js";import{U as F}from"./users-DhmV8JxR.js";import{F as v,C as B}from"./file-text-LH6G7VOa.js";import{C as T}from"./circle-alert-CwxN5lyF.js";const U=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],E=R("settings",U);function $(){const[n,o]=x.useState({total:0,completed:0,progress:0}),[c,m]=x.useState(!1),[i,f]=x.useState([]),[h,S]=x.useState("employee"),[j,C]=x.useState(null);z.useEffect(()=>{(async()=>{const s=await g.fetchEmployees();if(s&&Array.isArray(s)){const r=s.length;o({total:r,completed:0,progress:0})}})()},[]);const b=async(t,s)=>{const r=t.target.files[0];if(S(s),r)try{const a=await A.parseCSV(r);f(a),m(!0),t.target.value=""}catch{alert("CSV íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},N=async()=>{if(alert("ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”."),h==="employee"){const t=await g.syncEmployees(i);t.success?(o(s=>({...s,total:i.length})),m(!1),alert(`${i.length}ëª…ì˜ ì§ì› ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.`)):alert("ë™ê¸°í™” ì‹¤íŒ¨: "+t.error)}else{const t=I(i);C(t);const s=t.map(l=>{const p=parseFloat(l.totalScore)||0;let d="D";return p>=95?d="S":p>=85?d="A":p>=75?d="B":p>=65&&(d="C"),{name:l.Name||l.name||l.ì´ë¦„,team:l.Team||l.team||l.ë¶€ì„œ,totalScore:l.totalScore,grade:d}});localStorage.setItem("evaluationResults",JSON.stringify(s));const r={total:n.total,completed:t.length,completedRatio:Math.round(t.length/(n.total||1)*100)};o(r),localStorage.setItem("dashboardStats",JSON.stringify({totalUsers:r.total,completedCount:r.completed,completedRatio:r.completedRatio}));const a=await g.syncResults(t);a.success?(m(!1),alert("í‰ê°€ ê²°ê³¼ ë° ë¶„ì„ ë‚´ìš©ì´ ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.")):alert("ê²°ê³¼ ë™ê¸°í™” ì‹¤íŒ¨: "+a.error)}},I=t=>{const s={self:.2,peer:.2,manager:.4,sub:.2};return t.map(r=>{const a=parseFloat(r.SelfScore)||0,l=parseFloat(r.PeerScore)||0,p=parseFloat(r.ManagerScore)||0,d=parseFloat(r.SubordinateScore)||0,w=a*s.self+l*s.peer+p*s.manager+d*s.sub;return{...r,totalScore:w.toFixed(1)}})},k=(t,s,r)=>{const a=[...i];a[t][s]=r,f(a)};return e.jsxs("div",{className:"dashboard-grid animate-fade-in",children:[e.jsxs("div",{className:"card",style:{gridColumn:"1 / -1",marginBottom:"2rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{children:"ê´€ë¦¬ìë‹˜, ì•ˆë…•í•˜ì„¸ìš”."}),e.jsxs("a",{href:"#/admin/config",className:"btn btn-outline",style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem"},children:[e.jsx(E,{size:18})," ì„¤ì •"]})]}),e.jsx("p",{className:"text-sub",children:"2025ë…„ ê·¼ë¬´í‰ì • ì¢…í•© í˜„í™©ì…ë‹ˆë‹¤."}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"1.5rem",marginTop:"1.5rem"},children:[e.jsx(y,{icon:e.jsx(F,{className:"text-blue-500"}),label:"ì „ì²´ ëŒ€ìƒì",value:n.total,sub:"í‰ê°€ ëŒ€ìƒ"}),e.jsx(y,{icon:e.jsx(v,{className:"text-teal-500"}),label:"í‰ê°€ ì œì¶œ",value:n.completed,sub:"ì™„ë£Œ ê±´ìˆ˜"}),e.jsx(y,{icon:e.jsx(B,{className:"text-indigo-500"}),label:"ì§„í–‰ë¥ ",value:`${n.progress}%`,sub:"ì „ì²´ í‰ê· "}),e.jsxs("div",{className:"card",style:{border:"2px dashed var(--border-light)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",padding:"1rem",background:"rgba(255,255,255,0.5)"},children:[e.jsx("input",{type:"file",id:"csvInput",style:{display:"none"},onChange:t=>b(t,"employee"),accept:".csv"}),e.jsxs("label",{htmlFor:"csvInput",style:{cursor:"pointer",textAlign:"center",width:"100%"},children:[e.jsx(D,{className:"text-sub",size:32,style:{marginBottom:"0.5rem"}}),e.jsx("div",{style:{fontWeight:600},children:"ì§ì› ëª…ë‹¨ ì—…ë¡œë“œ"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-sub)"},children:"CSV í˜•ì‹ ì§€ì›"})]})]}),e.jsxs("div",{className:"card",style:{border:"2px dashed var(--primary-200)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",padding:"1rem",background:"var(--primary-50)"},children:[e.jsx("input",{type:"file",id:"resultInput",style:{display:"none"},onChange:t=>b(t,"result"),accept:".csv"}),e.jsxs("label",{htmlFor:"resultInput",style:{cursor:"pointer",textAlign:"center",width:"100%"},children:[e.jsx(v,{className:"text-primary-600",size:32,style:{marginBottom:"0.5rem"}}),e.jsx("div",{style:{fontWeight:600,color:"var(--primary-700)"},children:"í‰ê°€ ê²°ê³¼ ì—…ë¡œë“œ"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--primary-600)"},children:"ì ìˆ˜ ì·¨í•© CSV ë¶„ì„"})]})]})]}),j&&e.jsxs("div",{style:{marginTop:"2rem",padding:"1rem",background:"#f8fafc",borderRadius:"8px"},children:[e.jsx("h3",{children:"ğŸ“Š ë¶„ì„ ê²°ê³¼ ìš”ì•½"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"1rem",background:"white"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"var(--primary-100)"},children:[e.jsx("th",{style:{padding:"0.5rem"},children:"ì„±ëª…"}),e.jsx("th",{style:{padding:"0.5rem"},children:"ì§ìœ„"}),e.jsx("th",{style:{padding:"0.5rem"},children:"ì´ì "}),e.jsx("th",{style:{padding:"0.5rem"},children:"ë“±ê¸‰"})]})}),e.jsx("tbody",{children:j.map((t,s)=>e.jsxs("tr",{style:{borderBottom:"1px solid #eee",textAlign:"center"},children:[e.jsx("td",{style:{padding:"0.5rem"},children:t.Name||t.name}),e.jsx("td",{style:{padding:"0.5rem"},children:t.Role||t.role}),e.jsx("td",{style:{padding:"0.5rem",fontWeight:"bold"},children:t.totalScore}),e.jsx("td",{style:{padding:"0.5rem"},children:t.totalScore>=90?"S":t.totalScore>=80?"A":"B"})]},s))})]})]})]}),e.jsxs("div",{className:"card",style:{minHeight:"400px"},children:[e.jsx("h3",{children:"ë¶€ì„œë³„ í˜„í™©"}),e.jsx("p",{className:"text-sub",children:"ì‹¤ì‹œê°„ ì œì¶œ í˜„í™© ëª¨ë‹ˆí„°ë§"}),e.jsx("div",{style:{background:"var(--bg-input)",height:"200px",borderRadius:"var(--radius-md)",display:"flex",alignItems:"center",justifyContent:"center",marginTop:"1rem"},children:"ì°¨íŠ¸ ì˜ì—­ (ë°ì´í„° ì—°ë™ ì‹œ í™œì„±í™”)"})]}),e.jsxs("div",{className:"card",style:{minHeight:"400px"},children:[e.jsx("h3",{children:"ì£¼ìš” ì•Œë¦¼"}),e.jsxs("div",{style:{display:"flex",gap:"1rem",flexDirection:"column",marginTop:"1.5rem"},children:[e.jsx(u,{type:"weak",msg:"ë¯¸ì œì¶œ ì¸ì› 3ëª… (ë…ì´‰ í•„ìš”)"}),e.jsx(u,{type:"info",msg:"ìš´ì˜ì§€ì›íŒ€: í‰ê°€ ì™„ë£Œìœ¨ 90% ë‹¬ì„±"}),e.jsx(u,{type:"info",msg:"ì‚¬ì—…1íŒ€: í‰ê°€ ì™„ë£Œìœ¨ 85% ë‹¬ì„±"})]})]}),c&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{className:"card",style:{width:"80%",maxHeight:"80%",overflow:"hidden",display:"flex",flexDirection:"column",padding:"1.5rem"},children:[e.jsxs("h3",{children:["ë°ì´í„° ê²€ì¦ ë° ìˆ˜ì • (",h==="employee"?"ì§ì›ëª…ë¶€":"í‰ê°€ê²°ê³¼",")"]}),e.jsx("p",{className:"text-sub",style:{marginBottom:"1rem"},children:"ì—…ë¡œë“œëœ ë°ì´í„°ë¥¼ ê²€í† í•˜ê³  í•„ìš”ì‹œ ì§ì ‘ ìˆ˜ì •í•˜ì„¸ìš”."}),e.jsx("div",{style:{overflow:"auto",flex:1,border:"1px solid var(--border-light)",marginBottom:"1rem"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.9rem"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{position:"sticky",top:0,background:"var(--bg-input)"},children:i.length>0&&Object.keys(i[0]).map(t=>e.jsx("th",{style:{padding:"0.5rem"},children:t},t))})}),e.jsx("tbody",{children:i.slice(0,100).map((t,s)=>e.jsx("tr",{style:{borderBottom:"1px solid var(--border-light)"},children:Object.keys(t).map(r=>e.jsx("td",{style:{padding:"0.3rem"},children:e.jsx("input",{className:"input-field",value:t[r]||"",onChange:a=>k(s,r,a.target.value)})},r))},s))})]})}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>m(!1),children:"ì·¨ì†Œ"}),e.jsx("button",{className:"btn btn-primary",onClick:N,children:h==="employee"?"DB ë™ê¸°í™”":"ë¶„ì„ ì‹¤í–‰"})]})]})})]})}function y({icon:n,label:o,value:c,sub:m}){return e.jsxs("div",{style:{padding:"1.5rem",background:"var(--bg-input)",borderRadius:"var(--radius-md)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[o,n]}),e.jsx("div",{style:{fontSize:"2rem",fontWeight:700},children:c}),e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-sub)"},children:m})]})}function u({type:n,msg:o}){const c=n==="weak"?"#ef4444":"#3b82f6";return e.jsxs("div",{style:{padding:"1rem",borderLeft:`4px solid ${c}`,background:"var(--bg-input)",display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx(T,{size:20,color:c}),e.jsx("span",{children:o})]})}export{$ as default};
