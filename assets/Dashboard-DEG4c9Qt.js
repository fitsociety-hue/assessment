import{c as T,r as c,R as U,j as e}from"./index-wmy7qW5H.js";import{U as E,D as P}from"./dataEngine-CMve9JsT.js";import{A as x}from"./api-ao6i5wst.js";import{U as H}from"./users-KJAe2gxX.js";import{F as C,C as O}from"./file-text-BukrVkOa.js";import{C as V}from"./circle-alert-4Msiw5qc.js";const W=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],$=T("settings",W);function q(){const[n,d]=c.useState({total:0,completed:0,progress:0}),[m,p]=c.useState(!1),[i,j]=c.useState([]),[g,w]=c.useState("employee"),[f,N]=c.useState(null),[b,A]=c.useState([]),[v,k]=c.useState("");U.useEffect(()=>{(async()=>{const s=await x.fetchEmployees();if(s&&Array.isArray(s)){A(s);const r=s.length;d({total:r,completed:0,progress:0})}})()},[]);const I=async t=>{const s=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(r)).map(a=>a.toString(16).padStart(2,"0")).join("")},R=async t=>{const s=prompt(`'${t}' ì§ì›ì˜ ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.`);if(!s)return;if(s.length<4){alert("ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");return}const r=await I(s),l=await x.resetUserPassword({name:t,newPassword:r});l.success?alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤."):alert("ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì‹¤íŒ¨: "+l.message)},S=async(t,s)=>{const r=t.target.files[0];if(w(s),r)try{const l=await P.parseCSV(r);j(l),p(!0),t.target.value=""}catch{alert("CSV íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},z=async()=>{if(alert("ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”."),g==="employee"){const t=await x.syncEmployees(i);t.success?(d(s=>({...s,total:i.length})),p(!1),alert(`${i.length}ëª…ì˜ ì§ì› ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.`)):alert("ë™ê¸°í™” ì‹¤íŒ¨: "+t.error)}else{const t=B(i);N(t);const s=t.map(a=>{const h=parseFloat(a.totalScore)||0;let o="D";return h>=95?o="S":h>=85?o="A":h>=75?o="B":h>=65&&(o="C"),{name:a.Name||a.name||a.ì´ë¦„,team:a.Team||a.team||a.ë¶€ì„œ,totalScore:a.totalScore,grade:o}});localStorage.setItem("evaluationResults",JSON.stringify(s));const r={total:n.total,completed:t.length,completedRatio:Math.round(t.length/(n.total||1)*100)};d(r),localStorage.setItem("dashboardStats",JSON.stringify({totalUsers:r.total,completedCount:r.completed,completedRatio:r.completedRatio}));const l=await x.syncResults(t);l.success?(p(!1),alert("í‰ê°€ ê²°ê³¼ ë° ë¶„ì„ ë‚´ìš©ì´ ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.")):alert("ê²°ê³¼ ë™ê¸°í™” ì‹¤íŒ¨: "+l.error)}},B=t=>{const s={self:.2,peer:.2,manager:.4,sub:.2};return t.map(r=>{const l=parseFloat(r.SelfScore)||0,a=parseFloat(r.PeerScore)||0,h=parseFloat(r.ManagerScore)||0,o=parseFloat(r.SubordinateScore)||0,F=l*s.self+a*s.peer+h*s.manager+o*s.sub;return{...r,totalScore:F.toFixed(1)}})},D=(t,s,r)=>{const l=[...i];l[t][s]=r,j(l)};return e.jsxs("div",{className:"dashboard-grid animate-fade-in",children:[e.jsxs("div",{className:"card",style:{gridColumn:"1 / -1",marginBottom:"2rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{children:"ê´€ë¦¬ìë‹˜, ì•ˆë…•í•˜ì„¸ìš”."}),e.jsxs("a",{href:"#/admin/config",className:"btn btn-outline",style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem"},children:[e.jsx($,{size:18})," ì„¤ì •"]})]}),e.jsx("p",{className:"text-sub",children:"2025ë…„ ê·¼ë¬´í‰ì • ì¢…í•© í˜„í™©ì…ë‹ˆë‹¤."}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"1.5rem",marginTop:"1.5rem"},children:[e.jsx(y,{icon:e.jsx(H,{className:"text-blue-500"}),label:"ì „ì²´ ëŒ€ìƒì",value:n.total,sub:"í‰ê°€ ëŒ€ìƒ"}),e.jsx(y,{icon:e.jsx(C,{className:"text-teal-500"}),label:"í‰ê°€ ì œì¶œ",value:n.completed,sub:"ì™„ë£Œ ê±´ìˆ˜"}),e.jsx(y,{icon:e.jsx(O,{className:"text-indigo-500"}),label:"ì§„í–‰ë¥ ",value:`${n.progress}%`,sub:"ì „ì²´ í‰ê· "}),e.jsxs("div",{className:"card",style:{border:"2px dashed var(--border-light)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",padding:"1rem",background:"rgba(255,255,255,0.5)"},children:[e.jsx("input",{type:"file",id:"csvInput",style:{display:"none"},onChange:t=>S(t,"employee"),accept:".csv"}),e.jsxs("label",{htmlFor:"csvInput",style:{cursor:"pointer",textAlign:"center",width:"100%"},children:[e.jsx(E,{className:"text-sub",size:32,style:{marginBottom:"0.5rem"}}),e.jsx("div",{style:{fontWeight:600},children:"ì§ì› ëª…ë‹¨ ì—…ë¡œë“œ"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-sub)"},children:"CSV í˜•ì‹ ì§€ì›"})]})]}),e.jsxs("div",{className:"card",style:{border:"2px dashed var(--primary-200)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",padding:"1rem",background:"var(--primary-50)"},children:[e.jsx("input",{type:"file",id:"resultInput",style:{display:"none"},onChange:t=>S(t,"result"),accept:".csv"}),e.jsxs("label",{htmlFor:"resultInput",style:{cursor:"pointer",textAlign:"center",width:"100%"},children:[e.jsx(C,{className:"text-primary-600",size:32,style:{marginBottom:"0.5rem"}}),e.jsx("div",{style:{fontWeight:600,color:"var(--primary-700)"},children:"í‰ê°€ ê²°ê³¼ ì—…ë¡œë“œ"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--primary-600)"},children:"ì ìˆ˜ ì·¨í•© CSV ë¶„ì„"})]})]})]}),f&&e.jsxs("div",{style:{marginTop:"2rem",padding:"1rem",background:"#f8fafc",borderRadius:"8px"},children:[e.jsx("h3",{children:"ğŸ“Š ë¶„ì„ ê²°ê³¼ ìš”ì•½"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"1rem",background:"white"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"var(--primary-100)"},children:[e.jsx("th",{style:{padding:"0.5rem"},children:"ì„±ëª…"}),e.jsx("th",{style:{padding:"0.5rem"},children:"ì§ìœ„"}),e.jsx("th",{style:{padding:"0.5rem"},children:"ì´ì "}),e.jsx("th",{style:{padding:"0.5rem"},children:"ë“±ê¸‰"})]})}),e.jsx("tbody",{children:f.map((t,s)=>e.jsxs("tr",{style:{borderBottom:"1px solid #eee",textAlign:"center"},children:[e.jsx("td",{style:{padding:"0.5rem"},children:t.Name||t.name}),e.jsx("td",{style:{padding:"0.5rem"},children:t.Role||t.role}),e.jsx("td",{style:{padding:"0.5rem",fontWeight:"bold"},children:t.totalScore}),e.jsx("td",{style:{padding:"0.5rem"},children:t.totalScore>=90?"S":t.totalScore>=80?"A":"B"})]},s))})]})]})]}),e.jsxs("div",{className:"card",style:{minHeight:"400px"},children:[e.jsx("h3",{children:"ë¶€ì„œë³„ í˜„í™©"}),e.jsx("p",{className:"text-sub",children:"ì‹¤ì‹œê°„ ì œì¶œ í˜„í™© ëª¨ë‹ˆí„°ë§"}),e.jsx("div",{style:{background:"var(--bg-input)",height:"200px",borderRadius:"var(--radius-md)",display:"flex",alignItems:"center",justifyContent:"center",marginTop:"1rem"},children:"ì°¨íŠ¸ ì˜ì—­ (ë°ì´í„° ì—°ë™ ì‹œ í™œì„±í™”)"})]}),e.jsxs("div",{className:"card",style:{minHeight:"400px"},children:[e.jsx("h3",{children:"ì£¼ìš” ì•Œë¦¼"}),e.jsxs("div",{style:{display:"flex",gap:"1rem",flexDirection:"column",marginTop:"1.5rem"},children:[e.jsx(u,{type:"weak",msg:"ë¯¸ì œì¶œ ì¸ì› 3ëª… (ë…ì´‰ í•„ìš”)"}),e.jsx(u,{type:"info",msg:"ìš´ì˜ì§€ì›íŒ€: í‰ê°€ ì™„ë£Œìœ¨ 90% ë‹¬ì„±"}),e.jsx(u,{type:"info",msg:"ì‚¬ì—…1íŒ€: í‰ê°€ ì™„ë£Œìœ¨ 85% ë‹¬ì„±"})]})]}),e.jsxs("div",{className:"card",style:{gridColumn:"1 / -1",marginTop:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[e.jsx("h3",{children:"ì§ì› ê´€ë¦¬ (ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”)"}),e.jsx("input",{className:"input-field",placeholder:"ì´ë¦„ ê²€ìƒ‰...",style:{width:"200px"},value:v,onChange:t=>k(t.target.value)})]}),e.jsx("div",{style:{overflowX:"auto",maxHeight:"400px",overflowY:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.9rem"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"var(--bg-input)",borderBottom:"1px solid var(--border-light)"},children:[e.jsx("th",{style:{padding:"0.8rem",textAlign:"left"},children:"ì´ë¦„"}),e.jsx("th",{style:{padding:"0.8rem",textAlign:"left"},children:"ë¶€ì„œ"}),e.jsx("th",{style:{padding:"0.8rem",textAlign:"left"},children:"ì§ê¸‰"}),e.jsx("th",{style:{padding:"0.8rem",textAlign:"center"},children:"ê´€ë¦¬"})]})}),e.jsxs("tbody",{children:[b.filter(t=>t.name&&t.name.includes(v)).map((t,s)=>e.jsxs("tr",{style:{borderBottom:"1px solid var(--border-light)"},children:[e.jsx("td",{style:{padding:"0.8rem"},children:t.name}),e.jsx("td",{style:{padding:"0.8rem"},children:t.team}),e.jsx("td",{style:{padding:"0.8rem"},children:t.position}),e.jsx("td",{style:{padding:"0.8rem",textAlign:"center"},children:e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem 0.8rem",fontSize:"0.8rem"},onClick:()=>R(t.name),children:"ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •"})})]},s)),b.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",style:{padding:"2rem",textAlign:"center",color:"var(--text-sub)"},children:"ë“±ë¡ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤."})})]})]})})]}),m&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{className:"card",style:{width:"80%",maxHeight:"80%",overflow:"hidden",display:"flex",flexDirection:"column",padding:"1.5rem"},children:[e.jsxs("h3",{children:["ë°ì´í„° ê²€ì¦ ë° ìˆ˜ì • (",g==="employee"?"ì§ì›ëª…ë¶€":"í‰ê°€ê²°ê³¼",")"]}),e.jsx("p",{className:"text-sub",style:{marginBottom:"1rem"},children:"ì—…ë¡œë“œëœ ë°ì´í„°ë¥¼ ê²€í† í•˜ê³  í•„ìš”ì‹œ ì§ì ‘ ìˆ˜ì •í•˜ì„¸ìš”."}),e.jsx("div",{style:{overflow:"auto",flex:1,border:"1px solid var(--border-light)",marginBottom:"1rem"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.9rem"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{position:"sticky",top:0,background:"var(--bg-input)"},children:i.length>0&&Object.keys(i[0]).map(t=>e.jsx("th",{style:{padding:"0.5rem"},children:t},t))})}),e.jsx("tbody",{children:i.slice(0,100).map((t,s)=>e.jsx("tr",{style:{borderBottom:"1px solid var(--border-light)"},children:Object.keys(t).map(r=>e.jsx("td",{style:{padding:"0.3rem"},children:e.jsx("input",{className:"input-field",value:t[r]||"",onChange:l=>D(s,r,l.target.value)})},r))},s))})]})}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>p(!1),children:"ì·¨ì†Œ"}),e.jsx("button",{className:"btn btn-primary",onClick:z,children:g==="employee"?"DB ë™ê¸°í™”":"ë¶„ì„ ì‹¤í–‰"})]})]})})]})}function y({icon:n,label:d,value:m,sub:p}){return e.jsxs("div",{style:{padding:"1.5rem",background:"var(--bg-input)",borderRadius:"var(--radius-md)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[d,n]}),e.jsx("div",{style:{fontSize:"2rem",fontWeight:700},children:m}),e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-sub)"},children:p})]})}function u({type:n,msg:d}){const m=n==="weak"?"#ef4444":"#3b82f6";return e.jsxs("div",{style:{padding:"1rem",borderLeft:`4px solid ${m}`,background:"var(--bg-input)",display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx(V,{size:20,color:m}),e.jsx("span",{children:d})]})}export{q as default};
